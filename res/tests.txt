REM **********************************
REM TESTS
REM **********************************

NEW

10 D$ = "" : DIM TEST$(30), SEC$(20) : VERIFY = 10000
20 CALL-936 : REM HOME
30 PRINT "Running tests..."

100 REM ******************************
101 SEC$ = "Execution"
102 REM ******************************

110 E = 123
120 PRINT "RUN TESTS2"

SAVE TESTS

REM **********************************
REM TESTS2
REM **********************************

NEW

10 D$ = "" : DIM TEST$(30), SEC$(20) : VERIFY = 10000
100 REM ******************************
101 SEC$ = "Execution"
102 REM ******************************

110 TEST$ = "RUN clears variables"
111 A = (E <> 123) : GOSUB VERIFY

120 E = 456
121 PRINT D$;"CHAIN TESTS3"
122 A = 0 : GOSUB VERIFY

9999 PRINT "Tests complete" : END
10000 PRINT SEC$;": ";TEST$;": ";
10001 IF A THEN 10003
10002 POKE 50,127 : PRINT "FAILED" : POKE 50,255 : END
10003 PRINT "PASS" : RETURN

SAVE TESTS2

REM **********************************
REM TESTS3
REM **********************************

NEW

10 TEST$ = "CHAIN saves variables"
20 A = (E = 456) : GOSUB VERIFY

100 REM ******************************
101 SEC$ = "Binary Files"
102 REM ******************************

110 TEST$ = "BLOAD default addr"
111 E = 55 : POKE 8192,E
112 PRINT D$;"BSAVE BIN,A8192,L1"
113 POKE 8192,0
114 PRINT D$;"BLOAD BIN"
115 A = PEEK(8192) = E : GOSUB VERIFY

120 TEST$ = "BLOAD other addr"
121 E = 55 : POKE 8192,E
122 PRINT D$;"BSAVE BIN,A8192,L1"
123 POKE 8192,0 : POKE 8193,0
124 PRINT D$;"BLOAD BIN,A8193"
125 A = PEEK(8193) = E : GOSUB VERIFY

130 TEST$ = "BRUN default addr"
131 RTS = 96 : POKE 8192,RTS
132 PRINT D$;"BSAVE BIN,A8192,L1"
133 POKE 8192,0
134 PRINT D$;"BRUN BIN"
135 A = PEEK(8192) = RTS : GOSUB VERIFY

140 TEST$ = "BRUN other addr"
141 RTS = 96 : POKE 8192,RTS
142 PRINT D$;"BSAVE BIN,A8192,L1"
143 POKE 8192,0 : POKE 8193,0
144 PRINT D$;"BRUN BIN,A8193"
145 A = PEEK(8193) = RTS : GOSUB VERIFY

150 TEST$ = "BSAVE truncates"
151 POKE 8192,1 : POKE 8193,2
152 PRINT D$;"BSAVE BIN,A8192,L2"
153 POKE 8192,3 : POKE 8193,4
154 PRINT D$;"BSAVE BIN,A8192,L1"
155 POKE 8192,5 : POKE 8193,6
156 PRINT D$;"BLOAD BIN"
157 A = PEEK(8192) = 3 AND PEEK(8193) = 6 : GOSUB VERIFY

300 REM ******************************
301 SEC$ = "Parsing"
302 REM ******************************

310 TEST$ = "Argument spaces/commas"
311 PRINT D$;"BSAVE BIN , A8192 , L1"
312 A=1 : GOSUB VERIFY

320 TEST$ = "Argument hexadecimal"
321 PRINT D$;"BSAVE BIN , A$2000 , L$1"
322 A=1 : GOSUB VERIFY

330 TEST$ = "Path spaces / commas"
331 PRINT D$;"BSAVE BIN,A8192,L1"
332 PRINT D$;"BSAVE BIN2,A8192,L1" : PRINT D$;"DELETE BIN2"
333 PRINT D$;"RENAME BIN , BIN2 "
334 A=1 : GOSUB VERIFY

340 TEST$ = "Volume argument ignored"
341 PRINT D$;"BSAVE BIN,V0,A8192,L1"
342 PRINT D$;"BSAVE BIN,V1,A8192,L1"
343 PRINT D$;"BSAVE BIN,V254,A8192,L1"
344 A=1 : GOSUB VERIFY

350 TEST$ = "Leading spaces"
351 PRINT D$;" BSAVE BIN,A8192,L1"
352 A=1 : GOSUB VERIFY

400 REM ******************************
401 SEC$ = "Commands"
402 REM ******************************

410 TEST$ = "PREFIX"
411 PRINT D$;"PREFIX /RAM"
412 PRINT D$;"PREFIX /INTBASIC"
413 A=1 : GOSUB VERIFY

420 TEST$ = "SAVE"
421 PRINT D$;"SAVE BAS"
422 A=1 : GOSUB VERIFY

430 TEST$ = "DELETE"
431 PRINT D$;"SAVE BAS"
432 PRINT D$;"DELETE BAS"
433 A=1 : GOSUB VERIFY

440 TEST$ = "PR#"
441 PRINT D$;"PR#3"
442 PRINT D$;"PR#0"
443 A=1 : GOSUB VERIFY

450 TEST$ = "RENAME"
451 PRINT D$;"BSAVE BIN,A8192,L1"
452 PRINT D$;"BSAVE BIN2,A8192,L1" : PRINT D$;"DELETE BIN2"
453 PRINT D$;"RENAME BIN , BIN2 "
454 A=1 : GOSUB VERIFY

460 TEST$ = "MON"
461 PRINT D$;"MON"
462 PRINT D$;"MON I,C,O"
463 PRINT D$;"MONICO"
464 A=1 : GOSUB VERIFY

470 TEST$ = "NOMON"
471 PRINT D$;"NOMON"
472 PRINT D$;"NOMON I,C,O"
473 PRINT D$;"NOMONICO"
474 A=1 : GOSUB VERIFY

480 TEST$ = "LOCK"
481 PRINT D$;"BSAVE BIN,A8192,L1"
482 PRINT D$;"LOCK BIN"
483 A=1 : GOSUB VERIFY

490 TEST$ = "UNLOCK"
491 PRINT D$;"UNLOCK BIN"
492 A=1 : GOSUB VERIFY


9000 REM ******************************
9001 REM CLEANUP
9002 REM ******************************
9010 PRINT D$;"BSAVE BIN,A0,L1" : PRINT D$;"DELETE BIN"
9011 PRINT D$;"BSAVE BIN2,A0,L1" : PRINT D$;"DELETE BIN2"
9012 PRINT D$;"SAVE BAS" : PRINT D$;"DELETE BAS"

9999 PRINT "Tests complete" : END
10000 PRINT SEC$;": ";TEST$;": ";
10001 IF A THEN 10003
10002 POKE 50,127 : PRINT "FAILED" : POKE 50,255 : END
10003 PRINT "PASS" : RETURN

SAVE TESTS3

REM **********************************
REM START TESTS
REM **********************************

RUN TESTS
